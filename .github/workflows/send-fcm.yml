name: Send FCM v1 Notification
on:
  workflow_dispatch:

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Setup Service Account JSON
        run: echo '${{ secrets.FIREBASE_SERVICE_ACCOUNT }}' > service-account.json

      - name: Get Access Token
        id: get_token
        run: |
          ACCESS_TOKEN=$(curl -s -X POST -H "Content-Type: application/json" \
            -d @service-account.json \
            "https://oauth2.googleapis.com/token?grant_type=urn:ietf:params:oauth:grant-type:jwt-bearer&scope=https://www.googleapis.com/auth/firebase.messaging")
          echo "token=$(echo $ACCESS_TOKEN | jq -r .access_token)" >> $GITHUB_OUTPUT

      - name: Send FCM Message
        run: |
          curl -X POST "https://fcm.googleapis.com/v1/projects/YOUR_PROJECT_ID/messages:send" \
          -H "Authorization: Bearer ${{ steps.get_token.outputs.token }}" \
          -H "Content-Type: application/json" \
          --data '{
            "message": {
              "token": "USER_FCM_TOKEN",
              "notification": {
                "title": "Hello!",
                "body": "This is a test from GitHub Actions"
              }
            }
          }'
